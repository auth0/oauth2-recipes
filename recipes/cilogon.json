{"name":"cilogon","strategy":"oauth2","options":{"authorizationURL":"https://cilogon.org/authorize","tokenURL":"https://cilogon.org/oauth2/token","scope":"openid email profile org.cilogon.userinfo","scripts":{"fetchUserProfile":"function(accessToken, ctx, callback) {\n  'use strict';\n\n  const jwt = require('jsonwebtoken');\n  if (!ctx.id_token) return callback('missing-id_token');\n  const id_token = jwt.decode(ctx.id_token);\n  if (!id_token) return callback('malformed-id_token');\n  if (!id_token.sub) return callback('missing-sub');\n\n  const profile = {\n    user_id: id_token.sub,\n    email: id_token.email,\n    name: id_token.name,\n    given_name: id_token.given_name,\n    family_name: id_token.family_name,\n    idp: id_token.idp,\n    idp_name: id_token.idp_name,\n    eppn: id_token.eppn,\n    eptid: id_token.eptid,\n    oidc: id_token.oidc,\n    affiliation: id_token.affiliation,\n    ou: id_token.ou,\n    member_of: id_token.member_of,\n    cert_subject_dn: id_token.cert_subject_dn,\n    acr: id_token.acr,\n    entitlement: id_token.entitlement,\n    itrustuin: id_token.itrustuin\n  };\n\n  if (!id_token.name) {\n    profile.name = id_token.given_name + ' ' + id_token.family_name;\n  }\n\n  return callback(null, profile);\n}"}}}
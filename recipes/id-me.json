{"name":"id-me","strategy":"oauth2","options":{"authorizationURL":"https://api.id.me/oauth/authorize","tokenURL":"https://api.id.me/oauth/token","scope":"http://idmanagement.gov/ns/assurance/loa/1","scripts":{"fetchUserProfile":"function(accessToken, ctx, cb) {\n  \n  function mapProfile(source) {\n    var fieldsMap = {\n        'uuid': 'user_id',\n        'email': 'email',\n        'fname': 'given_name',\n        'lname': 'family_name'\n    };\n\n    var source = source.attributes;\n\t\t\n    var dest = {};\n    \n    for (var item of source) {\n        fieldsMap[item.handle] ? dest[fieldsMap[item.handle]] = item.value : dest[item.handle] = null;\n    }\n    \n    if(dest.given_name != null || dest.family_name != null) dest[\"name\"] = dest.given_name + \" \" + dest.family_name\n    return dest;\n}\n\n  \n request.get('https://api.id.me/api/public/v3/attributes.json?access_token=' + accessToken, {},\n    function(err, r, body) {\n      if (err) {\n        return cb(err);\n      }\n      try {\n\t\t\t\t\n        var data = JSON.parse(body);\n        var profile = mapProfile(data);\n        profile.provider = 'Id-Me';\n        cb(null, profile);\n\n\n\n      } catch (e) {\n        cb(e);\n      }\n    });\n\n\n}"}}}

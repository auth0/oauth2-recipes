{"name":"mailchimp","strategy":"oauth2","options":{"authorizationURL":"https://login.mailchimp.com/oauth2/authorize","tokenURL":"https://login.mailchimp.com/oauth2/token","scope":"","scripts":{"fetchUserProfile":"function doAuth(access_token, ctx, callback) {\n  var opts = {\n    'headers': {\n      'Authorization': 'OAuth ' + access_token,\n      'Accept': 'application/json',\n      'User-Agent': 'Auth0'\n    }\n  };\n\n  request.get('https://login.mailchimp.com/oauth2/metadata', opts, function(e, r, b) {\n    if (e) {\n      return callback(new Error('Failed Mailchimp Metadata Lookup' + e));\n    }\n    if (r.statusCode !== 200) {\n      return callback(new Error('Failed Mailchimp Metadata Lookup StatusCode:' + r.statusCode));\n    }\n    try {\n      var meta = JSON.parse(b);\n    } catch (e) {\n      return callback(new Error('Failed Mailchimp Metadata parsing JSON' + e));\n    }\n    request.get(meta.api_endpoint + '/3.0', opts, function(e, r, b) {\n      if (e) {\n        return callback(new Error('Failed Mailchimp User/Account Lookup' + e));\n      }\n      if (r.statusCode !== 200) {\n        return callback(new Error('Failed Mailchimp User/Account Lookup StatusCode:' + r.statusCode));\n      }\n      try {\n        var profile = JSON.parse(b);\n      } catch (e) {\n        return callback(new Error('Failed Mailchimp parsing profile JSON' + e + 'body: ' + b));\n      }\n      // See: https://auth0.com/docs/user-profile/normalized\n      var auth0Normalized = {\n        // \"email\": profile.email,\n        // \"email_verified\": true,\n        // \"family_name\": \"Foo\",\n        // \"gender\": \"male\",\n        // \"given_name\": \"John\",\n        // \"identities\": [{\n        //     \"provider\": \"Mailchimp\",\n        //     \"user_id\": profile.account_id,\n        //     \"connection\": \"MailchimpDev\",\n        //     \"isSocial\": true\n        // }],\n        // \"locale\": \"en\",\n        \"name\": profile.account_name,\n        \"nickname\": profile.username,\n        // \"picture\": \"https://lh4.googleusercontent.com/-OdsbOXom9qE/AAAAAAAAAAI/AAAAAAAAADU/_j8SzYTOJ4I/photo.jpg\",\n        \"user_id\": profile.account_id\n      };\n      var final = Object.assign({}, profile, auth0Normalized);\n      callback(null, final);\n    });\n  });\n}"}}}
{"name":"orcid","strategy":"oauth2","options":{"authorizationURL":"https://orcid.org/oauth/authorize","tokenURL":"https://orcid.org/oauth/token","scope":"/authenticate","scripts":{"fetchUserProfile":"function(accessToken, ctx, cb) {\n  // call oauth2 APIwith the accesstoken and create the profile\n  console.log(\"Processing FetchUserProfileScript\");\n\n  var options = {\n    url: 'https://pub.orcid.org/v2.1/' + ctx.orcid + '/email',\n    headers: {\n      'Authorization': 'Bearer ' + accessToken\n    }\n  };\n\n  var target = request.get(options, function(err, data) {\n    var bodyString = data.body.replace(/\\n/g, '');\n\n    var DOMParser = require('xmldom').DOMParser;\n    var parser = new DOMParser();\n    var xmlDoc = parser.parseFromString(bodyString, \"text/xml\");\n\n    var nodeEmail = xmlDoc.getElementsByTagName(\"email:email\")[1];\n\n    var orcid_email = '';\n    if (nodeEmail !== undefined) {\n      orcid_email = nodeEmail.childNodes[0].nodeValue;\n    }\n\n    console.log(ctx);\n\n    if (err == null) {\n      console.log(\"No errors\");\n    } else {\n      console.log(err);\n    }\n    var new_profile = {\n      name: ctx.name,\n      username: ctx.orcid,\n      email: (orcid_email != '' ? orcid_email : ctx.orcid),\n      user_id: ctx.orcid\n    };\n\n    cb(null, new_profile);\n  })\n\n\n\n}"}}}
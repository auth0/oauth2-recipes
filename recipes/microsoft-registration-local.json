{"name":"microsoft-registration-local","strategy":"oauth2","options":{"authorizationURL":"https://login.microsoftonline.com/common/oauth2/authorize","tokenURL":"https://login.microsoftonline.com/common/oauth2/token","scope":"openid","scripts":{"fetchUserProfile":"exports.fetchUserProfile = function(accessToken, ctx, cb) {\n  const _ = require('lodash'); // eslint-disable-line id-length\n  const jwt = require('jsonwebtoken');\n\n  if (!ctx) {\n    cb(new Error('BC-OA-0000: Invalid missing authentication information'), null);\n\n    return;\n  }\n\n  if (!ctx.id_token) {\n    cb(new Error('BC-MS-0000: Invalid missing id token'), null);\n\n    return;\n  }\n\n  const payload = jwt.decode(ctx.id_token);\n\n  if (!_.isPlainObject(payload)) {\n    cb(new Error('BC-MS-0001: Invalid id token format'), null);\n  } else if (!payload.oid) {\n    cb(new Error('BC-OA-0001: Missing user ID'), null);\n  } else if (!payload.tid) { // eslint-disable-line no-negated-condition\n    cb(new Error('BC-OA-0002: Missing tenant ID'), null);\n  } else {\n    const profile = {\n      user_id: payload.oid, // eslint-disable-line camelcase\n      email: payload.unique_name,\n      name: payload.name,\n      picture: payload.picture,\n      given_name: payload.given_name, // eslint-disable-line camelcase\n      family_name: payload.family_name, // eslint-disable-line camelcase\n      user_profile: { // eslint-disable-line camelcase\n        bettercloud: {\n          provider: 'microsoft_azure',\n          external_user_id: payload.oid, // eslint-disable-line camelcase\n          external_tenant_id: payload.tid // eslint-disable-line camelcase\n        }\n      }\n    };\n\n    cb(null, profile);\n  }\n}"}}}
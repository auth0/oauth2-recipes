{"name":"spotify","strategy":"oauth2","options":{"authorizationURL":"https://accounts.spotify.com/authorize","tokenURL":"https://accounts.spotify.com/api/token","scope":"user-read-recently-played","scripts":{"fetchUserProfile":"function(accessToken, ctx, cb) {\n  request.get({\n    url: 'https://api.spotify.com/v1/me',\n    headers: {\n      Authorization: 'Bearer ' + accessToken\n    }\n  }, function(err, resp, body) {\n    if (err) return cb(err);\n    if (resp.statusCode !== 200) return cb(new Error(body));\n\n    var json = JSON.parse(body);\n    // if (!resp.ok) return cb(new Error(body));\n\n    var profile = {\n        id: json.id,\n        email: json.email,\n        emailVerified: true,\n        name: json.display_name,\n        nickname: json.display_name,\n        spotify_id: json.id,\n        spotify_uri: json.uri,\n        spotify_product: json.product,\n        spotify_profile: json\n    }\n    if(json.images.length > 0) {\n        profile.picture = json.images[0].url\n    }\n    cb(null, profile);\n  });\n}"}}}
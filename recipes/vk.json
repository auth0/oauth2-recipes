{"name":"vk","strategy":"oauth2","options":{"authorizationURL":"https://oauth.vk.com/authorize","tokenURL":"https://oauth.vk.com/access_token","scope":"profile,email","scripts":{"fetchUserProfile":"function fetchUserProfile(access_token, ctx, callback){\n    request.get('https://api.vk.com/method/users.get?v=5.63&fields=photo_100&access_token=' + access_token, function(e, r, b){\n        if( e ) return callback(e);\n\n        if( r.statusCode !== 200 ) return callback(new Error('StatusCode: '+r.statusCode));\n        \n        try {\n            var res = JSON.parse(b);\n        } catch (e) {\n            return callback(new Error('Bad JSON response'));\n        }\n\n        if (!res.response) {\n            var msg = res.error ? res.error.error_msg : 'no resp';\n            return callback(new Error('NoResponse: ' + msg));\n        }\n        \n        var user = res.response[0];\n\n        var profile = {\n            user_id: ctx.user_id,\n            given_name: user.first_name,\n            family_name: user.last_name,\n            name: user.first_name + ' ' + user.last_name,\n            username: user.first_name + ' ' + user.last_name,\n            picture: user.photo_100,\n            email: ctx.email\n        };\n\n        callback(null, profile);\n    });\n}"}}}